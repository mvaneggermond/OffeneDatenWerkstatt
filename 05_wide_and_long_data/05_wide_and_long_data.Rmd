---
title: "Wide and long data"
author: "Michael van Eggermond"
date: "24/03/2021"
output: learnr::tutorial
runtime: shiny_prerendered
---
```{css, echo=FALSE}
p.caption {
  font-size: 0.9em;
  font-weight: bold;
  color: grey;
  margin-right: 10%;
  margin-left: 0%;  
  text-align: left;
}
```

```{r setup, include=FALSE, eval=TRUE}
library(learnr)
library(tidyverse)
library(lubridate)
library(scales)

checker <- function(label, user_code, check_code, envir_result, evaluate_result, ...) {
  list(message = check_code, correct = TRUE, location = "append")
}

tutorial_options(exercise.timelimit = 60, exercise.checker = checker)

knitr::opts_chunk$set(echo = FALSE)

# See this issue here: https://github.com/rstudio/learnr/issues/99

df_google_mobility <- readr::read_csv("https://drive.google.com/uc?id=11w225uoN_TtJd5QyvJHuYprL4d5rQTbi&export=download",
                           col_types = cols(
                             country_region_code = col_character(),
                             country_region = col_character(),
                             sub_region_1 = col_character(),
                             sub_region_2 = col_logical(),
                             metro_area = col_logical(),
                             iso_3166_2_code = col_character(),
                             census_fips_code = col_logical(),
                             place_id = col_character(),
                             date = col_date(),
                             retail_and_recreation_percent_change_from_baseline = col_double(),
                             grocery_and_pharmacy_percent_change_from_baseline = col_double(),
                             parks_percent_change_from_baseline = col_double(),
                             transit_stations_percent_change_from_baseline = col_double(),
                             workplaces_percent_change_from_baseline = col_double(),
                             residential_percent_change_from_baseline = col_double()
                           ))

df_google_mobility_bs <- df_google_mobility %>% 
  filter(iso_3166_2_code=='CH-BS') %>% 
  select(-country_region_code,
         -country_region,
         -sub_region_2,-metro_area,-iso_3166_2_code,-census_fips_code,-place_id)

df_google_mobility_zh <- df_google_mobility %>% filter(iso_3166_2_code=='CH-ZH')%>% 
  select(-country_region_code,
         -country_region,
         -sub_region_2,-metro_area,-iso_3166_2_code,-census_fips_code,-place_id)


```
## Welcome

In this tutorial we will look briefly at **wide** and **long** data sets. These concepts refer to the 'shape' of the data set, not to the contents themselves. Over the years, there have been a number of packages to help you to reshape your data. These include `reshape`, `reshape2` and `tidyr`. We will look into the usage of `tidyr` in this tutorial. 

I'll start with the concepts, then move on to an example and finally show how can reshape your data set. 


## Underlying concept

In general, data comes in two formats: 

Wide: in this format, many variables are stored in separate columns. Numerous examples exist: count location can be stored in columns, data of multiple years can be stored in columns, etc. Data in wide format is often hard to analyze and summarize. 


```{r fig-wide, echo = FALSE, out.width = "50%", fig.cap = "Wide data"}

knitr::include_graphics("images/wide_data.png")

```
Long: in this format, one column contains all the values and another column contains the context of the value. This format lends itself much better for analysis and visualization with the R package `ggplot` and software such as Tableau. More and more, you will see open data being made as long data. 

```{r fig-long, echo = FALSE, out.width = "50%", fig.cap = "Long data"}

knitr::include_graphics("images/long_data.png")

```

If you would like to learn more about tidy data, I can recommend the paper 'Tidy data' by Hadley Wickham, available [here](https://www.jstatsoft.org/article/view/v059i10){target="_blank"}.

## An example


```{r google_wide, echo=FALSE,message=FALSE}
df_google_mobility_bs
```


```{r google_long, echo=FALSE,message=FALSE}
df_google_mobility_bs %>% pivot_longer(-c("date","sub_region_1")) %>% filter(date='2020-02-15')
```
